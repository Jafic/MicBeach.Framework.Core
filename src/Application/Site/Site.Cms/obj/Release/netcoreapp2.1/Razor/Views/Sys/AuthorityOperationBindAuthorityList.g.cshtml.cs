#pragma checksum "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "e1c0a6a51ff333eb278ee21cc01ed81ffc72762e"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Views_Sys_AuthorityOperationBindAuthorityList), @"mvc.1.0.view", @"/Views/Sys/AuthorityOperationBindAuthorityList.cshtml")]
[assembly:global::Microsoft.AspNetCore.Mvc.Razor.Compilation.RazorViewAttribute(@"/Views/Sys/AuthorityOperationBindAuthorityList.cshtml", typeof(AspNetCore.Views_Sys_AuthorityOperationBindAuthorityList))]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
#line 1 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\_ViewImports.cshtml"
using Site.Cms;

#line default
#line hidden
#line 2 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\_ViewImports.cshtml"
using MicBeach.Web.Mvc;

#line default
#line hidden
#line 5 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
using MicBeach.Util.Extension;

#line default
#line hidden
#line 6 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
using MicBeach.Application.Identity.Auth;

#line default
#line hidden
#line 7 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
using MicBeach.Util.Serialize;

#line default
#line hidden
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"e1c0a6a51ff333eb278ee21cc01ed81ffc72762e", @"/Views/Sys/AuthorityOperationBindAuthorityList.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"0e5000250b2a0bb9c30615591362c9282acaa0ce", @"/Views/_ViewImports.cshtml")]
    public class Views_Sys_AuthorityOperationBindAuthorityList : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
#line 1 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
  
    ViewBag.Title = "操作权限";
    Layout = "~/Views/Shared/_Layout.cshtml";

#line default
#line hidden
#line 8 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
   
    var statusValues = AuthorityStatus.启用.GetType().GetEnumValueAndNames();

#line default
#line hidden
            BeginContext(278, 1404, true);
            WriteLiteral(@"<div id=""pc-head"">
    <div class=""panel panel-default bd-lw-0 bd-rad-0 mg-0 bd-w-0"">
        <div class=""panel-body pd-10"">
            <div class=""lis_search fl"">
                <div class=""input-group"">
                    <input type=""text"" class=""form-control w-200"" id=""search_authname"" placeholder=""权限名称/编码"">
                    <span class=""input-group-btn"">
                        <button class=""btn btn-default fc_3"" type=""button"" id=""searchbusiness_btn"" onclick=""SearchAuthority()""><i class=""glyphicon glyphicon-search""></i></button>
                    </span>
                </div>
            </div>
            <div class=""fr"">
                <button class=""btn btn-xs btn-blue"" id=""btn_addauthority""><i class=""glyphicon glyphicon-plus""></i> 添加</button>
                <button class=""btn btn-xs btn-danger"" id=""deleteselect_btn""><i class=""glyphicon glyphicon-trash""></i> 删除</button>
            </div>
        </div>
    </div>
</div>

<div id=""pc-body"">
    <div id=""pc-body-inner"">");
            WriteLiteral(@"
        <table class=""table table-striped table-bordered nowrap wp-100 bd-lw-0"" id=""auth_table"" cellpadding=""0"" cellspacing=""0"">
        </table>
    </div>
</div>

<div id=""pc-foot"">
    <div class=""txt-right form-submitbtn-con pdr-10""><button type=""button"" onclick=""CloseWindow()"" class=""btn btn-blue""><i class=""glyphicon glyphicon-off""></i> 关闭</button></div>
</div>

");
            EndContext();
            DefineSection("Scripts", async() => {
                BeginContext(1701, 267, true);
                WriteLiteral(@"
    <script type=""text/javascript"">
        BodyScroll = false;
        IsDialogPage = true;
        var nowAuthorityDatas = new Object();
        var authStatusDic = new Object();
        $(function () {
            
            authStatusDic = JSON.parse('");
                EndContext();
                BeginContext(1969, 50, false);
#line 50 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
                                   Write(Html.Raw(JsonSerialize.ObjectToJson(statusValues)));

#line default
#line hidden
                EndContext();
                BeginContext(2019, 2695, true);
                WriteLiteral(@"');

            //搜索事件
            $(""#search_btn"").click(function () {
                SearchAuthority();
            });

            //创建权限
            $(""#btn_addauthority"").click(function () {
                SelectAuthority();
            });

            //删除权限
            $(""body"").on(""click"", "".btn_delete_auth"", function () {
                var sysNo = $(this).attr(""sysno"");
                DeleteAuthority(sysNo);
            });

            //删除选中
            $(""#deleteselect_btn"").click(function () {
                var checkedValues = GetDataTableCheckedValues('#auth_table');
                if (!checkedValues || checkedValues.length <= 0) {
                    ErrorMsg(""还没有选择要删除的信息"");
                    return;
                }
                var checkedValueString = checkedValues.join("","");
                DeleteAuthority(checkedValueString);
            });
            //操作表格
            InitDataTable({
                TableEle: '#auth_table',
              ");
                WriteLiteral(@"  ""columnDefs"": [
                        {
                            ""title"": '<input type=""checkbox"" class=""cbx_all""/>', ""targets"": 0, ""data"": function (row, type, val, meta) {
                                return '<input type=""checkbox"" class=""cbx_val"" value=""' + row.Code + '""/>';
                            }, width: '20px', className: 'txt-center'
                        },
                        { ""title"": ""编码"", ""targets"": 1, ""data"": 'Code', width: '100px' },
                        {
                            ""title"": ""名称"", ""targets"": 2, ""data"": 'Name', width: '150px'
                        },
                        { ""title"": ""分组"", ""targets"": 3, ""data"": 'AuthGroup.Name' },
                        {
                            ""title"": ""状态"", ""targets"": 4, ""data"": 'Status', width: '50px', className: 'txt-center', render: function (data, type, row, meta) {
                                return authStatusDic[data];
                            }
                        },
        ");
                WriteLiteral(@"                {
                            ""title"": ""操作"", ""targets"": 5, ""data"": function (row, type, val, meta) {
                                return '<button type=""button"" class=""btn btn-xs btn-danger btn_delete_auth"" sysno=""' + row.Code + '""><i class=""glyphicon glyphicon-trash""></i> 删除</button>';
                            }, width: '62px', className: 'txt-center'
                        },
                ]
            });

            SearchAuthority();
        })

        //搜索权限
        function SearchAuthority() {
            var data = {
                AuthorityOperationFilter: {
                    SysNos: ['");
                EndContext();
                BeginContext(4715, 19, false);
#line 112 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
                         Write(ViewBag.OperationId);

#line default
#line hidden
                EndContext();
                BeginContext(4734, 130, true);
                WriteLiteral("\']\r\n                },\r\n                NameCodeMateKey: $.trim($(\"#search_authname\").val())\r\n            };\r\n            $.post(\'");
                EndContext();
                BeginContext(4865, 58, false);
#line 116 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
               Write(Url.Action("AuthorityOperationBindAuthoritySearch", "Sys"));

#line default
#line hidden
                EndContext();
                BeginContext(4923, 795, true);
                WriteLiteral(@"', data, function (res) {
                var jsonData = JSON.parse(res.Datas);
                ReplaceDataTableData(""#auth_table"", jsonData);
                $(window).resize();
                if (jsonData.Data) {
                    for (var d in jsonData.Data) {
                        nowAuthorityDatas[d] = { Data: jsonData.Data[d], Status: 0 };
                    }
                }
                InitDataTableChecked(""#auth_table"");
            });
        }

        //删除权限
        function DeleteAuthority(sysnos) {
            if (!sysnos || sysnos == """") {
                return;
            }
            UnBindAuthority(sysnos.split(','));
        };

        //选择权限
        function SelectAuthority() {
            DialogPage({
                url: '");
                EndContext();
                BeginContext(5719, 40, false);
#line 140 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
                 Write(Url.Action("AuthorityMultiSelect","Sys"));

#line default
#line hidden
                EndContext();
                BeginContext(5759, 1071, true);
                WriteLiteral(@"',
                width: ""600px"",
                height: ""400px"",
                title: '选择权限',
                ok: false,
                cancel: null
            });
        }

        //权限选中回调
        function AuthorityMultiSelectCallback(authDatas) {
            if (!authDatas) {
                return;
            }
            var newAuthCodes = new Array();
            for (var a in authDatas) {
                var auth = authDatas[a];
                if (!auth) {
                    continue;
                }
                var nowAuth = nowAuthorityDatas[auth.Code];
                if (nowAuth) {
                    continue;
                }
                newAuthCodes.push(auth.Code);
            }
            if (newAuthCodes.length > 0) {
                BindAuthority(newAuthCodes);
            }
        }

        //绑定权限
        function BindAuthority(codes) {
            if (!codes || codes.length <= 0) {
                return;
            }
         ");
                WriteLiteral("   var data = {\r\n                operationId: \'");
                EndContext();
                BeginContext(6831, 19, false);
#line 177 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
                         Write(ViewBag.OperationId);

#line default
#line hidden
                EndContext();
                BeginContext(6850, 73, true);
                WriteLiteral("\',\r\n                authCodes:codes\r\n            };\r\n            $.post(\'");
                EndContext();
                BeginContext(6924, 43, false);
#line 180 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
               Write(Url.Action("OperationBindAuthority", "Sys"));

#line default
#line hidden
                EndContext();
                BeginContext(6967, 388, true);
                WriteLiteral(@"', data, function (res) {
                ResultMsg(res);
                if (res.Success) {
                    SearchAuthority();
                }
            });
        }

        //解绑权限
        function UnBindAuthority(codes) {
            if (!codes || codes.length <= 0) {
                return;
            }
            var data = {
                operationId: '");
                EndContext();
                BeginContext(7356, 19, false);
#line 194 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
                         Write(ViewBag.OperationId);

#line default
#line hidden
                EndContext();
                BeginContext(7375, 178, true);
                WriteLiteral("\',\r\n                authCodes: codes\r\n            };\r\n            for (var c in codes) {\r\n                nowAuthorityDatas[codes[c]] = null;\r\n            }\r\n            $.post(\'");
                EndContext();
                BeginContext(7554, 45, false);
#line 200 "F:\Project\Framework\MicBeach.Core\App-Test\Web\Application\Site\Site.Cms\Views\Sys\AuthorityOperationBindAuthorityList.cshtml"
               Write(Url.Action("OperationUnBindAuthority", "Sys"));

#line default
#line hidden
                EndContext();
                BeginContext(7599, 296, true);
                WriteLiteral(@"', data, function (res) {
                ResultMsg(res);
                if (res.Success) {
                    SearchAuthority();
                }
            });
        }

        //关闭
        function CloseWindow() {
            art.dialog.close(true);
        }
    </script>
");
                EndContext();
            }
            );
        }
        #pragma warning restore 1998
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<dynamic> Html { get; private set; }
    }
}
#pragma warning restore 1591
